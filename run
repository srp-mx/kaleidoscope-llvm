BUILD_DIR="build"
PLATFORM="linux"

LLVM_COMPILE_FLAGS="llvm-config --cxxflags --ldflags --system-libs --libs core orcjit native"
EXTRA_COMPILE_FLAGS="-rdynamic"
COMPILE_OUTPUT="./${BUILD_DIR}/${PLATFORM}_kaleidoscope"

# Clean
echo "Cleaning..."
mkdir ./${BUILD_DIR}
rm -r ./${BUILD_DIR}/*
echo "Done cleaning."
echo ""

# Compile
echo "Compiling for ${PLATFORM}..."
echo "LLVM FLAGS: ${LLVM_COMPILE_FLAGS}"
echo "EXTRA FLAGS: ${EXTRA_COMPILE_FLAGS}"
clang++ -g -O3 ./src/${PLATFORM}_kaleidoscope.cpp `${LLVM_COMPILE_FLAGS}` ${EXTRA_COMPILE_FLAGS} -o ${COMPILE_OUTPUT}
echo "Done compiling."
echo "OUTPUT: ${COMPILE_OUTPUT}"
echo ""

# Run
echo "Running..."
eval ${COMPILE_OUTPUT}
echo ""
echo "Done running."
